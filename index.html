<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OblivionX - Get Your Key</title>

<style>
/* ---- STYLES UNCHANGED ---- */
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;
  background:linear-gradient(135deg,#0a0b0e,#17191c);
  color:#eaeaf5;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px
}
.container{
  max-width:600px;width:100%;
  background:#17191c;
  border-radius:16px;
  border:1px solid #2a2d36;
  padding:40px;
  box-shadow:0 8px 32px rgba(0,0,0,.4)
}
.logo{font-size:32px;font-weight:600;color:#8c5aff;text-align:center}
.subtitle{text-align:center;color:#a0a0af;margin-bottom:30px}
.step{margin-bottom:30px}
.step-header{display:flex;align-items:center;margin-bottom:15px}
.step-number{
  width:32px;height:32px;border-radius:50%;
  background:#8c5aff;color:#0b0b0e;
  display:flex;align-items:center;justify-content:center;
  margin-right:12px;font-weight:600
}
.system-select{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.system-option{
  background:#121318;border:2px solid #2a2d36;
  border-radius:12px;padding:20px;text-align:center;
  cursor:pointer;transition:.2s
}
.system-option.selected{border-color:#8c5aff}
.system-option input{display:none}
.checkpoint-button{
  width:100%;padding:14px;
  border-radius:10px;border:none;
  font-weight:600;font-size:15px;
  background:#8c5aff;color:#0b0b0e;
  cursor:pointer
}
.checkpoint-button:disabled{background:#2a2d36;color:#666}
.key-display{display:none;margin-top:15px}
.key-display.show{display:block}
.key-value{
  background:#0a0b0e;border:1px solid #2a2d36;
  border-radius:8px;padding:12px;
  font-family:monospace;color:#8c5aff;
  text-align:center;margin:15px 0
}
.copy-button{
  background:#1e2026;color:#fff;
  border:1px solid #2a2d36;
  padding:10px 24px;border-radius:8px;
  cursor:pointer
}
.status-message{display:none;margin-top:15px;padding:12px;border-radius:8px}
.status-message.show{display:block}
.status-message.success{background:rgba(76,175,80,.2);color:#4caf50}
.status-message.error{background:rgba(244,67,54,.2);color:#f44336}
.status-message.info{background:rgba(33,150,243,.2);color:#2196f3}
.loading{
  display:inline-block;width:16px;height:16px;
  border:2px solid #2a2d36;
  border-top-color:#8c5aff;
  border-radius:50%;
  animation:spin .8s linear infinite;
  margin-left:6px
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="container">

<div class="logo">OblivionX</div>
<div class="subtitle">Get your key to access OblivionX</div>

<div class="step">
<div class="step-header">
<div class="step-number">1</div>
<div>Select System</div>
</div>
<div class="system-select">
<label class="system-option selected">
<input type="radio" name="system" value="workink" checked>
<div>Workink</div>
<div style="color:#a0a0af;font-size:13px">24 Hour Key</div>
</label>
<label class="system-option">
<input type="radio" name="system" value="lootlabs">
<div>Lootlabs</div>
<div style="color:#a0a0af;font-size:13px">72 Hour Key</div>
</label>
</div>
</div>

<div class="step">
<div class="step-header">
<div class="step-number">2</div>
<div>Generate Key</div>
</div>
<button class="checkpoint-button" id="checkpoint-btn">
Generate Key
</button>
</div>

<div class="key-display" id="key-display">
<div>Your key:</div>
<div class="key-value" id="key-value">Oblivion-XXXX-XXXX-XXXX</div>
<button class="copy-button" id="copy-btn">Copy</button>
</div>

<div class="status-message" id="status-message"></div>

</div>

<script>
const API_BASE_URL = "https://api-kn3m.onrender.com/api";
const WORKINK_LINK = "https://work.ink/2cZy/oblivionx-key-system";
const LOOTLABS_LINK = "https://lootdest.org/s?45pjCbyj";

const btn = document.getElementById("checkpoint-btn");
const keyBox = document.getElementById("key-value");
const keyDisplay = document.getElementById("key-display");
const statusMsg = document.getElementById("status-message");
const copyBtn = document.getElementById("copy-btn");

document.querySelectorAll(".system-option").forEach(opt=>{
  opt.onclick=()=>{
    document.querySelectorAll(".system-option").forEach(o=>o.classList.remove("selected"));
    opt.classList.add("selected");
    opt.querySelector("input").checked=true;
  }
});

btn.onclick = async () => {
  const system = document.querySelector("input[name=system]:checked").value;
  const sessionId = getSessionId();

  // optional: open link but DO NOT wait
  window.open(system==="workink"?WORKINK_LINK:LOOTLABS_LINK,"_blank");

  btn.disabled = true;
  btn.innerHTML = "Generating key<span class='loading'></span>";
  showStatus("Generating key...", "info");

  try {
    const res = await fetch(API_BASE_URL + "/generate-key", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ sessionId, system })
    });

    const data = await res.json();

    if (data.success) {
      keyBox.textContent = data.key;
      keyDisplay.classList.add("show");
      showStatus("Key generated successfully!", "success");
    } else {
      throw new Error(data.message);
    }
  } catch {
    showStatus("Failed to generate key.", "error");
    btn.disabled=false;
    btn.textContent="Generate Key";
  }
};

copyBtn.onclick = async ()=>{
  await navigator.clipboard.writeText(keyBox.textContent);
  showStatus("Key copied!", "success");
};

function showStatus(msg,type){
  statusMsg.textContent=msg;
  statusMsg.className="status-message show "+type;
}

function getSessionId(){
  let id=localStorage.getItem("oblivion_session");
  if(!id){
    id="session_"+Date.now()+"_"+Math.random().toString(36).slice(2);
    localStorage.setItem("oblivion_session",id);
  }
  return id;
}
</script>
</body>
</html>
